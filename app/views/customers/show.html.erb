<% content_for(:page_title) { @customer.name } %>

<div class="flex justify-between items-center mb-6">
  <div class="flex items-center gap-4">
    <div class="avatar avatar-lg"><%= @customer.name[0] %></div>
    <div>
      <h1 class="text-xl font-bold text-zinc-900"><%= @customer.name %></h1>
      <p class="text-sm text-zinc-500"><%= @customer.phone %></p>
    </div>
  </div>
  <div class="flex gap-2">
    <%= link_to edit_customer_path(@customer), class: "btn btn-secondary" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
      편집
    <% end %>
    <%= link_to customers_path, class: "btn btn-ghost" do %>
      목록
    <% end %>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-6">
  <div class="card">
    <div class="card-body">
      <div class="stat">
        <p class="stat-title">연락처</p>
        <p class="stat-value text-xl"><%= @customer.phone %></p>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <div class="stat">
        <p class="stat-title">포인트</p>
        <p class="stat-value text-xl text-blue-600"><%= number_with_delimiter(@customer.point_balance) %>P</p>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <div class="stat">
        <p class="stat-title">정액권 잔액</p>
        <p class="stat-value text-xl text-emerald-600"><%= number_to_currency(@customer.prepaid_balance, unit: "₩", precision: 0) %></p>
      </div>
    </div>
  </div>
</div>

<% if @customer.memo.present? %>
  <div class="card mb-6">
    <div class="card-body">
      <p class="stat-title mb-2">메모</p>
      <p class="text-sm text-zinc-700"><%= @customer.memo %></p>
    </div>
  </div>
<% end %>

<div class="card">
  <div class="px-6 py-4 border-b border-zinc-100">
    <h2 class="card-title">최근 방문</h2>
  </div>
  <% if @visits.any? %>
    <div class="divide-y divide-zinc-100">
      <% @visits.each do |visit| %>
        <div class="px-6 py-4 flex items-center justify-between hover:bg-zinc-50 transition-colors">
          <div>
            <p class="text-sm font-medium text-zinc-900"><%= visit.visited_at.strftime("%Y.%m.%d %H:%M") %></p>
          </div>
          <div class="flex items-center gap-4">
            <span class="text-sm font-semibold text-zinc-900"><%= number_to_currency(visit.total_amount, unit: "₩", precision: 0) %></span>
            <% if visit.finalized? %>
              <span class="badge badge-success">확정</span>
            <% else %>
              <span class="badge badge-warning">임시</span>
            <% end %>
            <%= link_to transactions_visit_path(visit), class: "btn btn-ghost btn-sm" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="px-6 py-12 text-center">
      <p class="text-sm text-zinc-500">방문 내역이 없습니다</p>
    </div>
  <% end %>
</div>
